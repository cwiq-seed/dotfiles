#!/bin/sh

set -e

{{- if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.ID "ubuntu") }}

echo "Detected Ubuntu on Linux – preparing to install Homebrew."

if ! command -v brew >/dev/null 2>&1; then
  echo "Homebrew not found – installing..."

  # Ensure required packages
  sudo apt-get update
  sudo apt-get install -y build-essential procps curl file git

  # Install Homebrew non-interactively
  NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

  # Set up environment
  echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.profile
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

  echo "Homebrew installation complete."
else
  echo "Homebrew already installed."
fi

{{- else }}
echo "Skipping Homebrew install – not Ubuntu on Linux."
{{- end }}

